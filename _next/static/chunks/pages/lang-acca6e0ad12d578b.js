(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[519],{481:function(n,s,e){(window.__NEXT_P=window.__NEXT_P||[]).push(["/lang",function(){return e(8915)}])},8915:function(n,s,e){"use strict";e.r(s),e.d(s,{default:function(){return t}});var a=e(5893),c=e(6282),l=e(7090);let i=function(n){let{children:s}=n;return(0,a.jsx)(l.Z,{active:"lang",children:(0,a.jsx)("div",{className:"content",children:s})})};function o(n){let s={a:"a",code:"code",details:"details",div:"div",h1:"h1",h2:"h2",hr:"hr",li:"li",nav:"nav",ol:"ol",p:"p",pre:"pre",span:"span",summary:"summary",ul:"ul",...(0,c.a)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.nav,{className:"toc",children:(0,a.jsxs)(s.ol,{className:"toc-level toc-level-1",children:[(0,a.jsx)(s.li,{className:"toc-item toc-item-h1",children:(0,a.jsx)(s.a,{className:"toc-link toc-link-h1",href:"#ir",children:"IR"})}),(0,a.jsx)(s.li,{className:"toc-item toc-item-h1",children:(0,a.jsx)(s.a,{className:"toc-link toc-link-h1",href:"#zig",children:"Zig"})}),(0,a.jsxs)(s.li,{className:"toc-item toc-item-h1",children:[(0,a.jsx)(s.a,{className:"toc-link toc-link-h1",href:"#c",children:"C"}),(0,a.jsxs)(s.ol,{className:"toc-level toc-level-2",children:[(0,a.jsx)(s.li,{className:"toc-item toc-item-h2",children:(0,a.jsx)(s.a,{className:"toc-link toc-link-h2",href:"#forward-declaration-for-apis",children:"Forward declaration for APIs"})}),(0,a.jsx)(s.li,{className:"toc-item toc-item-h2",children:(0,a.jsx)(s.a,{className:"toc-link toc-link-h2",href:"#overloading",children:"Overloading"})}),(0,a.jsx)(s.li,{className:"toc-item toc-item-h2",children:(0,a.jsx)(s.a,{className:"toc-link toc-link-h2",href:"#macros",children:"Macros"})})]})]})]})}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["\n",(0,a.jsx)(s.p,{children:"Reflection"}),"\n"]}),"\n",(0,a.jsxs)(s.li,{children:["\n",(0,a.jsx)(s.p,{children:"JIT"}),"\n"]}),"\n",(0,a.jsxs)(s.li,{children:["\n",(0,a.jsx)(s.p,{children:"RAII: Resource Acquisition Is Initialization or RAII, is a C++ programming technique[1][2] which binds the life cycle of a resource that must be acquired before use (allocated heap memory, thread of execution, open socket, open file, locked mutex, disk space, database connectionâ€”anything that exists in limited supply) to the lifetime of an object."}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(s.h1,{id:"ir",children:"IR"}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["mlir docs: ",(0,a.jsx)(s.a,{href:"https://mlir.llvm.org/",children:"https://mlir.llvm.org/"})]}),"\n",(0,a.jsxs)(s.li,{children:["mlir paper: ",(0,a.jsx)(s.a,{href:"https://arxiv.org/abs/2002.11054",children:"https://arxiv.org/abs/2002.11054"})]}),"\n",(0,a.jsxs)(s.li,{children:["mlir tutorial: ",(0,a.jsx)(s.a,{href:"https://mlir.llvm.org/docs/Tutorials/",children:"https://mlir.llvm.org/docs/Tutorials/"})]}),"\n",(0,a.jsxs)(s.li,{children:["mlir github tutorial: ",(0,a.jsx)(s.a,{href:"https://github.com/j2kun/mlir-tutorial?tab=readme-ov-file",children:"https://github.com/j2kun/mlir-tutorial?tab=readme-ov-file"})]}),"\n",(0,a.jsxs)(s.li,{children:["mlir affine dialect: ",(0,a.jsx)(s.a,{href:"https://mlir.llvm.org/docs/Dialects/Affine/",children:"https://mlir.llvm.org/docs/Dialects/Affine/"})]}),"\n",(0,a.jsxs)(s.li,{children:["polytope models: ",(0,a.jsx)(s.a,{href:"https://en.wikipedia.org/wiki/Polytope_model",children:"https://en.wikipedia.org/wiki/Polytope_model"})]}),"\n"]}),"\n",(0,a.jsx)(s.h1,{id:"zig",children:"Zig"}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"https://renerocks.ai/blog/zig-bound-functions/",children:"https://renerocks.ai/blog/zig-bound-functions/"})}),"\n"]}),"\n",(0,a.jsx)(s.h1,{id:"c",children:"C"}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsx)(s.h2,{id:"forward-declaration-for-apis",children:"Forward declaration for APIs"}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsx)(s.p,{children:"A nice trick to conceal the field members of a struct in a public API function for a library function is to use forward declarations in the public header for the specified struct like so:"}),"\n",(0,a.jsxs)(s.details,{className:"code-accordion",open:!0,children:[(0,a.jsx)(s.summary,{className:"code-accordion-summary",children:"C"}),(0,a.jsx)(s.div,{className:"code-accordion-content",children:(0,a.jsx)(s.div,{className:"remark-highlight",children:(0,a.jsx)(s.pre,{className:"language-c",children:(0,a.jsxs)(s.code,{className:"language-c",children:[(0,a.jsx)(s.span,{className:"token comment",children:"// private-api.h"}),"\n",(0,a.jsx)(s.span,{className:"token keyword",children:"struct"})," ",(0,a.jsx)(s.span,{className:"token class-name",children:"my_struct"})," ",(0,a.jsx)(s.span,{className:"token punctuation",children:"{"}),"\n    ",(0,a.jsx)(s.span,{className:"token keyword",children:"int"})," field1",(0,a.jsx)(s.span,{className:"token punctuation",children:";"}),"\n    ",(0,a.jsx)(s.span,{className:"token keyword",children:"int"})," field2",(0,a.jsx)(s.span,{className:"token punctuation",children:";"}),"\n",(0,a.jsx)(s.span,{className:"token punctuation",children:"}"}),"\n"]})})})})]}),"\n",(0,a.jsxs)(s.details,{className:"code-accordion",open:!0,children:[(0,a.jsx)(s.summary,{className:"code-accordion-summary",children:"C"}),(0,a.jsx)(s.div,{className:"code-accordion-content",children:(0,a.jsx)(s.div,{className:"remark-highlight",children:(0,a.jsx)(s.pre,{className:"language-c",children:(0,a.jsxs)(s.code,{className:"language-c",children:[(0,a.jsx)(s.span,{className:"token comment",children:"// public-api.c"}),"\n",(0,a.jsxs)(s.span,{className:"token macro property",children:[(0,a.jsx)(s.span,{className:"token directive-hash",children:"#"}),(0,a.jsx)(s.span,{className:"token directive keyword",children:"include"})," ",(0,a.jsx)(s.span,{className:"token string",children:'"private-api.h"'})]}),"\n\nmy_struct",(0,a.jsx)(s.span,{className:"token operator",children:"*"})," ",(0,a.jsx)(s.span,{className:"token function",children:"a_function"}),(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),(0,a.jsx)(s.span,{className:"token keyword",children:"void"}),(0,a.jsx)(s.span,{className:"token punctuation",children:")"})," ",(0,a.jsx)(s.span,{className:"token punctuation",children:"{"}),"\n    ",(0,a.jsx)(s.span,{className:"token comment",children:"// contents"}),"\n    ",(0,a.jsx)(s.span,{className:"token keyword",children:"return"})," ",(0,a.jsx)(s.span,{className:"token constant",children:"NULL"}),(0,a.jsx)(s.span,{className:"token punctuation",children:";"}),"\n",(0,a.jsx)(s.span,{className:"token punctuation",children:"}"}),"\n"]})})})})]}),"\n",(0,a.jsxs)(s.details,{className:"code-accordion",open:!0,children:[(0,a.jsx)(s.summary,{className:"code-accordion-summary",children:"C"}),(0,a.jsx)(s.div,{className:"code-accordion-content",children:(0,a.jsx)(s.div,{className:"remark-highlight",children:(0,a.jsx)(s.pre,{className:"language-c",children:(0,a.jsxs)(s.code,{className:"language-c",children:[(0,a.jsx)(s.span,{className:"token comment",children:"// api.h"}),"\n",(0,a.jsx)(s.span,{className:"token keyword",children:"typedef"})," ",(0,a.jsx)(s.span,{className:"token keyword",children:"struct"})," ",(0,a.jsx)(s.span,{className:"token class-name",children:"my_struct"})," my_struct",(0,a.jsx)(s.span,{className:"token punctuation",children:";"}),"\n\n",(0,a.jsx)(s.span,{className:"token comment",children:"// Here we use the forward declared type"}),"\nmy_struct",(0,a.jsx)(s.span,{className:"token operator",children:"*"})," ",(0,a.jsx)(s.span,{className:"token function",children:"a_function"}),(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),(0,a.jsx)(s.span,{className:"token keyword",children:"void"}),(0,a.jsx)(s.span,{className:"token punctuation",children:")"}),(0,a.jsx)(s.span,{className:"token punctuation",children:";"}),"\n"]})})})})]}),"\n",(0,a.jsx)(s.p,{children:"Then we can use the function like follows:"}),"\n",(0,a.jsxs)(s.details,{className:"code-accordion",open:!0,children:[(0,a.jsx)(s.summary,{className:"code-accordion-summary",children:"C"}),(0,a.jsx)(s.div,{className:"code-accordion-content",children:(0,a.jsx)(s.div,{className:"remark-highlight",children:(0,a.jsx)(s.pre,{className:"language-c",children:(0,a.jsxs)(s.code,{className:"language-c",children:[(0,a.jsx)(s.span,{className:"token comment",children:"// main.c"}),"\n",(0,a.jsxs)(s.span,{className:"token macro property",children:[(0,a.jsx)(s.span,{className:"token directive-hash",children:"#"}),(0,a.jsx)(s.span,{className:"token directive keyword",children:"include"})," ",(0,a.jsx)(s.span,{className:"token string",children:'"api.h"'})]}),"\n\n",(0,a.jsx)(s.span,{className:"token keyword",children:"int"})," ",(0,a.jsx)(s.span,{className:"token function",children:"main"}),(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),(0,a.jsx)(s.span,{className:"token keyword",children:"void"}),(0,a.jsx)(s.span,{className:"token punctuation",children:")"})," ",(0,a.jsx)(s.span,{className:"token punctuation",children:"{"}),"\n    ",(0,a.jsx)(s.span,{className:"token comment",children:"// Ok"}),"\n    my_struct",(0,a.jsx)(s.span,{className:"token operator",children:"*"})," ptr ",(0,a.jsx)(s.span,{className:"token operator",children:"="})," ",(0,a.jsx)(s.span,{className:"token function",children:"a_function"}),(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),(0,a.jsx)(s.span,{className:"token punctuation",children:")"}),(0,a.jsx)(s.span,{className:"token punctuation",children:";"}),"\n\n    ",(0,a.jsx)(s.span,{className:"token comment",children:"// Invalid! We CAN'T do this, as the compiler does not know"}),"\n    ",(0,a.jsx)(s.span,{className:"token comment",children:"// how my_struct looks like during the compilation of main.c"}),"\n    ptr",(0,a.jsx)(s.span,{className:"token operator",children:"->"}),"field1 ",(0,a.jsx)(s.span,{className:"token operator",children:"="})," ",(0,a.jsx)(s.span,{className:"token number",children:"0"}),(0,a.jsx)(s.span,{className:"token punctuation",children:";"}),"\n    ",(0,a.jsx)(s.span,{className:"token keyword",children:"return"})," ",(0,a.jsx)(s.span,{className:"token number",children:"0"}),(0,a.jsx)(s.span,{className:"token punctuation",children:";"}),"\n",(0,a.jsx)(s.span,{className:"token punctuation",children:"}"}),"\n"]})})})})]}),"\n",(0,a.jsx)(s.h2,{id:"overloading",children:"Overloading"}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsxs)(s.p,{children:["Let's say you want to overwrite an API-function located in a library that you don't have any control over or a standard\nlibrary function. This is useful when you want to stub that function in some test bench or insert debugging information\nin the function itself. To do this, we can make use of C-macros. Let's say we want to overwrite ",(0,a.jsx)(s.code,{children:"malloc"}),". We first\ndefine our own malloc like so:"]}),"\n",(0,a.jsxs)(s.details,{className:"code-accordion",open:!0,children:[(0,a.jsx)(s.summary,{className:"code-accordion-summary",children:"C"}),(0,a.jsx)(s.div,{className:"code-accordion-content",children:(0,a.jsx)(s.div,{className:"remark-highlight",children:(0,a.jsx)(s.pre,{className:"language-c",children:(0,a.jsxs)(s.code,{className:"language-c",children:[(0,a.jsx)(s.span,{className:"token keyword",children:"void"}),(0,a.jsx)(s.span,{className:"token operator",children:"*"})," ",(0,a.jsx)(s.span,{className:"token function",children:"my_malloc"}),(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),(0,a.jsx)(s.span,{className:"token class-name",children:"size_t"})," size",(0,a.jsx)(s.span,{className:"token punctuation",children:")"}),"\n",(0,a.jsx)(s.span,{className:"token punctuation",children:"{"}),"\n  ",(0,a.jsx)(s.span,{className:"token function",children:"printf"}),(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),(0,a.jsx)(s.span,{className:"token string",children:'"my_malloc"'}),(0,a.jsx)(s.span,{className:"token punctuation",children:")"}),(0,a.jsx)(s.span,{className:"token punctuation",children:";"}),"\n  ",(0,a.jsx)(s.span,{className:"token keyword",children:"return"})," ",(0,a.jsx)(s.span,{className:"token constant",children:"NULL"}),(0,a.jsx)(s.span,{className:"token punctuation",children:";"}),"\n",(0,a.jsx)(s.span,{className:"token punctuation",children:"}"}),"\n"]})})})})]}),"\n",(0,a.jsxs)(s.p,{children:["Then we can define the following macro to replace all instances of ",(0,a.jsx)(s.code,{children:"malloc"})," with our newly defined ",(0,a.jsx)(s.code,{children:"my_malloc"}),":"]}),"\n",(0,a.jsxs)(s.details,{className:"code-accordion",open:!0,children:[(0,a.jsx)(s.summary,{className:"code-accordion-summary",children:"C"}),(0,a.jsx)(s.div,{className:"code-accordion-content",children:(0,a.jsx)(s.div,{className:"remark-highlight",children:(0,a.jsx)(s.pre,{className:"language-c",children:(0,a.jsxs)(s.code,{className:"language-c",children:[(0,a.jsxs)(s.span,{className:"token macro property",children:[(0,a.jsx)(s.span,{className:"token directive-hash",children:"#"}),(0,a.jsx)(s.span,{className:"token directive keyword",children:"define"})," ",(0,a.jsx)(s.span,{className:"token macro-name",children:"malloc"})," ",(0,a.jsx)(s.span,{className:"token expression",children:"my_malloc"})]}),"\n"]})})})})]}),"\n",(0,a.jsx)(s.p,{children:"Compiling and running yields us:"}),"\n",(0,a.jsxs)(s.details,{className:"code-accordion",open:!0,children:[(0,a.jsx)(s.summary,{className:"code-accordion-summary",children:"Bash"}),(0,a.jsx)(s.div,{className:"code-accordion-content",children:(0,a.jsx)(s.div,{className:"remark-highlight",children:(0,a.jsx)(s.pre,{className:"language-bash",children:(0,a.jsxs)(s.code,{className:"language-bash",children:[(0,a.jsx)(s.span,{className:"token operator",children:">"})," clang main.c ",(0,a.jsx)(s.span,{className:"token operator",children:"&&"})," ./a.out\nmy_malloc\n"]})})})})]}),"\n",(0,a.jsxs)(s.p,{children:["What if we want to make use of the original ",(0,a.jsx)(s.code,{children:"malloc"})," in our newly created ",(0,a.jsx)(s.code,{children:"my_malloc"}),"? This could be problematic as the define replaces all instances of ",(0,a.jsx)(s.code,{children:"malloc"})," with ",(0,a.jsx)(s.code,{children:"my_malloc"}),". So creating a ",(0,a.jsx)(s.code,{children:"my_malloc"})," like this will cause the macro to be recursively executed:"]}),"\n",(0,a.jsxs)(s.details,{className:"code-accordion",open:!0,children:[(0,a.jsx)(s.summary,{className:"code-accordion-summary",children:"C"}),(0,a.jsx)(s.div,{className:"code-accordion-content",children:(0,a.jsx)(s.div,{className:"remark-highlight",children:(0,a.jsx)(s.pre,{className:"language-c",children:(0,a.jsxs)(s.code,{className:"language-c",children:[(0,a.jsx)(s.span,{className:"token keyword",children:"void"}),(0,a.jsx)(s.span,{className:"token operator",children:"*"})," ",(0,a.jsx)(s.span,{className:"token function",children:"my_malloc"}),(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),(0,a.jsx)(s.span,{className:"token class-name",children:"size_t"})," size",(0,a.jsx)(s.span,{className:"token punctuation",children:")"}),"\n",(0,a.jsx)(s.span,{className:"token punctuation",children:"{"}),"\n  ",(0,a.jsx)(s.span,{className:"token function",children:"printf"}),(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),(0,a.jsx)(s.span,{className:"token string",children:'"my_malloc"'}),(0,a.jsx)(s.span,{className:"token punctuation",children:")"}),(0,a.jsx)(s.span,{className:"token punctuation",children:";"}),"\n  ",(0,a.jsx)(s.span,{className:"token keyword",children:"return"})," ",(0,a.jsx)(s.span,{className:"token function",children:"malloc"}),(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),"size",(0,a.jsx)(s.span,{className:"token punctuation",children:")"}),(0,a.jsx)(s.span,{className:"token punctuation",children:";"}),"\n",(0,a.jsx)(s.span,{className:"token punctuation",children:"}"}),"\n"]})})})})]}),"\n",(0,a.jsx)(s.p,{children:"Compling and running this instead will result in:"}),"\n",(0,a.jsxs)(s.details,{className:"code-accordion",open:!0,children:[(0,a.jsx)(s.summary,{className:"code-accordion-summary",children:"Bash"}),(0,a.jsx)(s.div,{className:"code-accordion-content",children:(0,a.jsx)(s.div,{className:"remark-highlight",children:(0,a.jsx)(s.pre,{className:"language-bash",children:(0,a.jsxs)(s.code,{className:"language-bash",children:[(0,a.jsx)(s.span,{className:"token operator",children:">"})," clang main.c ",(0,a.jsx)(s.span,{className:"token operator",children:"&&"})," ./a.out\nmy_mallocmy_mallocm",(0,a.jsx)(s.span,{className:"token punctuation",children:".."}),".y_malloSegmentation fault ",(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),"core dumped",(0,a.jsx)(s.span,{className:"token punctuation",children:")"}),"\n"]})})})})]}),"\n",(0,a.jsxs)(s.p,{children:["Where the dots represent ",(0,a.jsx)(s.code,{children:"my_malloc"})," being printed MANY times."]}),"\n",(0,a.jsxs)(s.p,{children:["To make this work, we have to place ",(0,a.jsx)(s.code,{children:"my_malloc"})," in a separate source file. Since source files are preprocessed to\ntranslation units along with all the includes and compiled separately from each other, a define in e.g., ",(0,a.jsx)(s.code,{children:"main.c"})," will not affect a wrapper in e.g., ",(0,a.jsx)(s.code,{children:"malloc.c"}),". So we create the following files:"]}),"\n",(0,a.jsxs)(s.details,{className:"code-accordion",open:!0,children:[(0,a.jsx)(s.summary,{className:"code-accordion-summary",children:"C"}),(0,a.jsx)(s.div,{className:"code-accordion-content",children:(0,a.jsx)(s.div,{className:"remark-highlight",children:(0,a.jsx)(s.pre,{className:"language-c",children:(0,a.jsxs)(s.code,{className:"language-c",children:[(0,a.jsx)(s.span,{className:"token comment",children:"// malloc.c"}),"\n",(0,a.jsx)(s.span,{className:"token keyword",children:"void"}),(0,a.jsx)(s.span,{className:"token operator",children:"*"})," ",(0,a.jsx)(s.span,{className:"token function",children:"my_malloc"}),(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),(0,a.jsx)(s.span,{className:"token class-name",children:"size_t"})," size",(0,a.jsx)(s.span,{className:"token punctuation",children:")"}),"\n",(0,a.jsx)(s.span,{className:"token punctuation",children:"{"}),"\n  ",(0,a.jsx)(s.span,{className:"token function",children:"printf"}),(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),(0,a.jsx)(s.span,{className:"token string",children:'"my_malloc"'}),(0,a.jsx)(s.span,{className:"token punctuation",children:")"}),(0,a.jsx)(s.span,{className:"token punctuation",children:";"}),"\n  ",(0,a.jsx)(s.span,{className:"token keyword",children:"return"})," ",(0,a.jsx)(s.span,{className:"token function",children:"malloc"}),(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),"size",(0,a.jsx)(s.span,{className:"token punctuation",children:")"}),(0,a.jsx)(s.span,{className:"token punctuation",children:";"}),"\n",(0,a.jsx)(s.span,{className:"token punctuation",children:"}"}),"\n"]})})})})]}),"\n",(0,a.jsxs)(s.details,{className:"code-accordion",open:!0,children:[(0,a.jsx)(s.summary,{className:"code-accordion-summary",children:"C"}),(0,a.jsx)(s.div,{className:"code-accordion-content",children:(0,a.jsx)(s.div,{className:"remark-highlight",children:(0,a.jsx)(s.pre,{className:"language-c",children:(0,a.jsxs)(s.code,{className:"language-c",children:[(0,a.jsx)(s.span,{className:"token comment",children:"// main.c"}),"\n",(0,a.jsxs)(s.span,{className:"token macro property",children:[(0,a.jsx)(s.span,{className:"token directive-hash",children:"#"}),(0,a.jsx)(s.span,{className:"token directive keyword",children:"define"})," ",(0,a.jsx)(s.span,{className:"token macro-name",children:"malloc"})," ",(0,a.jsx)(s.span,{className:"token expression",children:"my_malloc"})]}),"\n\n",(0,a.jsx)(s.span,{className:"token keyword",children:"void"}),(0,a.jsx)(s.span,{className:"token operator",children:"*"})," ",(0,a.jsx)(s.span,{className:"token function",children:"my_malloc"}),(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),(0,a.jsx)(s.span,{className:"token class-name",children:"size_t"})," size",(0,a.jsx)(s.span,{className:"token punctuation",children:")"}),(0,a.jsx)(s.span,{className:"token punctuation",children:";"}),"\n\n",(0,a.jsx)(s.span,{className:"token keyword",children:"int"})," ",(0,a.jsx)(s.span,{className:"token function",children:"main"}),(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),(0,a.jsx)(s.span,{className:"token keyword",children:"int"}),(0,a.jsx)(s.span,{className:"token punctuation",children:")"}),"\n",(0,a.jsx)(s.span,{className:"token punctuation",children:"{"}),"\n  ",(0,a.jsx)(s.span,{className:"token keyword",children:"void"}),(0,a.jsx)(s.span,{className:"token operator",children:"*"})," ptr ",(0,a.jsx)(s.span,{className:"token operator",children:"="})," ",(0,a.jsx)(s.span,{className:"token function",children:"malloc"}),(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),(0,a.jsx)(s.span,{className:"token number",children:"4"}),(0,a.jsx)(s.span,{className:"token punctuation",children:")"}),(0,a.jsx)(s.span,{className:"token punctuation",children:";"}),"\n  ",(0,a.jsx)(s.span,{className:"token keyword",children:"return"})," ",(0,a.jsx)(s.span,{className:"token number",children:"0"}),(0,a.jsx)(s.span,{className:"token punctuation",children:";"}),"\n",(0,a.jsx)(s.span,{className:"token punctuation",children:"}"}),"\n"]})})})})]}),"\n",(0,a.jsx)(s.p,{children:"Now it is possible to compile and execute without all those recursive calls:"}),"\n",(0,a.jsxs)(s.details,{className:"code-accordion",open:!0,children:[(0,a.jsx)(s.summary,{className:"code-accordion-summary",children:"Bash"}),(0,a.jsx)(s.div,{className:"code-accordion-content",children:(0,a.jsx)(s.div,{className:"remark-highlight",children:(0,a.jsx)(s.pre,{className:"language-bash",children:(0,a.jsxs)(s.code,{className:"language-bash",children:[(0,a.jsx)(s.span,{className:"token operator",children:">"})," clang main.c malloc.c ",(0,a.jsx)(s.span,{className:"token operator",children:"&&"})," ./a.out\nmy_malloc\n"]})})})})]}),"\n",(0,a.jsxs)(s.p,{children:["We can now wrap the function declaration in a header file and include it wherever we want to\noverwrite ",(0,a.jsx)(s.code,{children:"malloc"}),":"]}),"\n",(0,a.jsxs)(s.details,{className:"code-accordion",open:!0,children:[(0,a.jsx)(s.summary,{className:"code-accordion-summary",children:"C"}),(0,a.jsx)(s.div,{className:"code-accordion-content",children:(0,a.jsx)(s.div,{className:"remark-highlight",children:(0,a.jsx)(s.pre,{className:"language-c",children:(0,a.jsxs)(s.code,{className:"language-c",children:[(0,a.jsx)(s.span,{className:"token comment",children:"// malloc.h"}),"\n",(0,a.jsxs)(s.span,{className:"token macro property",children:[(0,a.jsx)(s.span,{className:"token directive-hash",children:"#"}),(0,a.jsx)(s.span,{className:"token directive keyword",children:"define"})," ",(0,a.jsx)(s.span,{className:"token macro-name",children:"malloc"})," ",(0,a.jsx)(s.span,{className:"token expression",children:"my_malloc"})]}),"\n\n",(0,a.jsx)(s.span,{className:"token keyword",children:"void"}),(0,a.jsx)(s.span,{className:"token operator",children:"*"})," ",(0,a.jsx)(s.span,{className:"token function",children:"my_malloc"}),(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),(0,a.jsx)(s.span,{className:"token class-name",children:"size_t"})," size",(0,a.jsx)(s.span,{className:"token punctuation",children:")"}),(0,a.jsx)(s.span,{className:"token punctuation",children:";"}),"\n"]})})})})]}),"\n",(0,a.jsx)(s.h2,{id:"macros",children:"Macros"}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsxs)(s.p,{children:["A way to reduce the amount of repetitive code while making sure that names correspond to each other in different places we can make use of the following macro-concept (taken from the ",(0,a.jsx)(s.a,{href:"https://github.com/llvm/llvm-project",children:"llvm-project"}),"):"]}),"\n",(0,a.jsxs)(s.details,{className:"code-accordion",open:!0,children:[(0,a.jsx)(s.summary,{className:"code-accordion-summary",children:"C"}),(0,a.jsx)(s.div,{className:"code-accordion-content",children:(0,a.jsx)(s.div,{className:"remark-highlight",children:(0,a.jsx)(s.pre,{className:"language-c",children:(0,a.jsxs)(s.code,{className:"language-c",children:[(0,a.jsx)(s.span,{className:"token comment",children:"// clang/lib/CodeGen/CodeGenFunction.h"}),"\n",(0,a.jsxs)(s.span,{className:"token macro property",children:[(0,a.jsx)(s.span,{className:"token directive-hash",children:"#"}),(0,a.jsx)(s.span,{className:"token directive keyword",children:"define"})," ",(0,a.jsx)(s.span,{className:"token macro-name",children:"LIST_SANITIZER_CHECKS"}),"                                                  ",(0,a.jsx)(s.span,{className:"token punctuation",children:"\\"}),"\n  ",(0,a.jsxs)(s.span,{className:"token expression",children:[(0,a.jsx)(s.span,{className:"token function",children:"SANITIZER_CHECK"}),(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),"AddOverflow",(0,a.jsx)(s.span,{className:"token punctuation",children:","})," add_overflow",(0,a.jsx)(s.span,{className:"token punctuation",children:","})," ",(0,a.jsx)(s.span,{className:"token number",children:"0"}),(0,a.jsx)(s.span,{className:"token punctuation",children:")"}),"                                "]}),(0,a.jsx)(s.span,{className:"token punctuation",children:"\\"}),"\n  ",(0,a.jsxs)(s.span,{className:"token expression",children:[(0,a.jsx)(s.span,{className:"token function",children:"SANITIZER_CHECK"}),(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),"BuiltinUnreachable",(0,a.jsx)(s.span,{className:"token punctuation",children:","})," builtin_unreachable",(0,a.jsx)(s.span,{className:"token punctuation",children:","})," ",(0,a.jsx)(s.span,{className:"token number",children:"0"}),(0,a.jsx)(s.span,{className:"token punctuation",children:")"}),"                  "]}),(0,a.jsx)(s.span,{className:"token punctuation",children:"\\"}),"\n  ",(0,a.jsxs)(s.span,{className:"token expression",children:[(0,a.jsx)(s.span,{className:"token function",children:"SANITIZER_CHECK"}),(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),"CFICheckFail",(0,a.jsx)(s.span,{className:"token punctuation",children:","})," cfi_check_fail",(0,a.jsx)(s.span,{className:"token punctuation",children:","})," ",(0,a.jsx)(s.span,{className:"token number",children:"0"}),(0,a.jsx)(s.span,{className:"token punctuation",children:")"}),"                             "]}),(0,a.jsx)(s.span,{className:"token punctuation",children:"\\"}),"\n  ",(0,a.jsxs)(s.span,{className:"token expression",children:[(0,a.jsx)(s.span,{className:"token function",children:"SANITIZER_CHECK"}),(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),"DivremOverflow",(0,a.jsx)(s.span,{className:"token punctuation",children:","})," divrem_overflow",(0,a.jsx)(s.span,{className:"token punctuation",children:","})," ",(0,a.jsx)(s.span,{className:"token number",children:"0"}),(0,a.jsx)(s.span,{className:"token punctuation",children:")"}),"                          "]}),(0,a.jsx)(s.span,{className:"token punctuation",children:"\\"}),"\n  ",(0,a.jsxs)(s.span,{className:"token expression",children:[(0,a.jsx)(s.span,{className:"token function",children:"SANITIZER_CHECK"}),(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),"DynamicTypeCacheMiss",(0,a.jsx)(s.span,{className:"token punctuation",children:","})," dynamic_type_cache_miss",(0,a.jsx)(s.span,{className:"token punctuation",children:","})," ",(0,a.jsx)(s.span,{className:"token number",children:"0"}),(0,a.jsx)(s.span,{className:"token punctuation",children:")"}),"            "]}),(0,a.jsx)(s.span,{className:"token punctuation",children:"\\"}),"\n  ",(0,a.jsxs)(s.span,{className:"token expression",children:[(0,a.jsx)(s.span,{className:"token function",children:"SANITIZER_CHECK"}),(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),"FloatCastOverflow",(0,a.jsx)(s.span,{className:"token punctuation",children:","})," float_cast_overflow",(0,a.jsx)(s.span,{className:"token punctuation",children:","})," ",(0,a.jsx)(s.span,{className:"token number",children:"0"}),(0,a.jsx)(s.span,{className:"token punctuation",children:")"}),"                   "]}),(0,a.jsx)(s.span,{className:"token punctuation",children:"\\"}),"\n  ",(0,a.jsxs)(s.span,{className:"token expression",children:[(0,a.jsx)(s.span,{className:"token function",children:"SANITIZER_CHECK"}),(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),"FunctionTypeMismatch",(0,a.jsx)(s.span,{className:"token punctuation",children:","})," function_type_mismatch",(0,a.jsx)(s.span,{className:"token punctuation",children:","})," ",(0,a.jsx)(s.span,{className:"token number",children:"0"}),(0,a.jsx)(s.span,{className:"token punctuation",children:")"}),"             "]}),(0,a.jsx)(s.span,{className:"token punctuation",children:"\\"}),"\n  ",(0,a.jsxs)(s.span,{className:"token expression",children:[(0,a.jsx)(s.span,{className:"token function",children:"SANITIZER_CHECK"}),(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),"ImplicitConversion",(0,a.jsx)(s.span,{className:"token punctuation",children:","})," implicit_conversion",(0,a.jsx)(s.span,{className:"token punctuation",children:","})," ",(0,a.jsx)(s.span,{className:"token number",children:"0"}),(0,a.jsx)(s.span,{className:"token punctuation",children:")"}),"                  "]}),(0,a.jsx)(s.span,{className:"token punctuation",children:"\\"}),"\n  ",(0,a.jsxs)(s.span,{className:"token expression",children:[(0,a.jsx)(s.span,{className:"token function",children:"SANITIZER_CHECK"}),(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),"InvalidBuiltin",(0,a.jsx)(s.span,{className:"token punctuation",children:","})," invalid_builtin",(0,a.jsx)(s.span,{className:"token punctuation",children:","})," ",(0,a.jsx)(s.span,{className:"token number",children:"0"}),(0,a.jsx)(s.span,{className:"token punctuation",children:")"}),"                          "]}),(0,a.jsx)(s.span,{className:"token punctuation",children:"\\"}),"\n  ",(0,a.jsxs)(s.span,{className:"token expression",children:[(0,a.jsx)(s.span,{className:"token function",children:"SANITIZER_CHECK"}),(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),"InvalidObjCCast",(0,a.jsx)(s.span,{className:"token punctuation",children:","})," invalid_objc_cast",(0,a.jsx)(s.span,{className:"token punctuation",children:","})," ",(0,a.jsx)(s.span,{className:"token number",children:"0"}),(0,a.jsx)(s.span,{className:"token punctuation",children:")"}),"                       "]}),(0,a.jsx)(s.span,{className:"token punctuation",children:"\\"}),"\n  ",(0,a.jsxs)(s.span,{className:"token expression",children:[(0,a.jsx)(s.span,{className:"token function",children:"SANITIZER_CHECK"}),(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),"LoadInvalidValue",(0,a.jsx)(s.span,{className:"token punctuation",children:","})," load_invalid_value",(0,a.jsx)(s.span,{className:"token punctuation",children:","})," ",(0,a.jsx)(s.span,{className:"token number",children:"0"}),(0,a.jsx)(s.span,{className:"token punctuation",children:")"}),"                     "]}),(0,a.jsx)(s.span,{className:"token punctuation",children:"\\"}),"\n  ",(0,a.jsxs)(s.span,{className:"token expression",children:[(0,a.jsx)(s.span,{className:"token function",children:"SANITIZER_CHECK"}),(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),"MissingReturn",(0,a.jsx)(s.span,{className:"token punctuation",children:","})," missing_return",(0,a.jsx)(s.span,{className:"token punctuation",children:","})," ",(0,a.jsx)(s.span,{className:"token number",children:"0"}),(0,a.jsx)(s.span,{className:"token punctuation",children:")"})]})]}),"\n\n",(0,a.jsx)(s.span,{className:"token keyword",children:"enum"})," ",(0,a.jsx)(s.span,{className:"token class-name",children:"SanitizerHandler"})," ",(0,a.jsx)(s.span,{className:"token punctuation",children:"{"}),"\n",(0,a.jsxs)(s.span,{className:"token macro property",children:[(0,a.jsx)(s.span,{className:"token directive-hash",children:"#"}),(0,a.jsx)(s.span,{className:"token directive keyword",children:"define"})," ",(0,a.jsx)(s.span,{className:"token macro-name function",children:"SANITIZER_CHECK"}),(0,a.jsxs)(s.span,{className:"token expression",children:[(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),"Enum",(0,a.jsx)(s.span,{className:"token punctuation",children:","})," Name",(0,a.jsx)(s.span,{className:"token punctuation",children:","})," Version",(0,a.jsx)(s.span,{className:"token punctuation",children:")"})," Enum",(0,a.jsx)(s.span,{className:"token punctuation",children:","})]})]}),"\n  LIST_SANITIZER_CHECKS\n",(0,a.jsxs)(s.span,{className:"token macro property",children:[(0,a.jsx)(s.span,{className:"token directive-hash",children:"#"}),(0,a.jsx)(s.span,{className:"token directive keyword",children:"undef"})," ",(0,a.jsx)(s.span,{className:"token expression",children:"SANITIZER_CHECK"})]}),"\n",(0,a.jsx)(s.span,{className:"token punctuation",children:"}"}),(0,a.jsx)(s.span,{className:"token punctuation",children:";"}),"\n"]})})})})]}),"\n",(0,a.jsx)(s.p,{children:"Here we define and un-define the macro again in another file:"}),"\n",(0,a.jsxs)(s.details,{className:"code-accordion",open:!0,children:[(0,a.jsx)(s.summary,{className:"code-accordion-summary",children:"C"}),(0,a.jsx)(s.div,{className:"code-accordion-content",children:(0,a.jsx)(s.div,{className:"remark-highlight",children:(0,a.jsx)(s.pre,{className:"language-c",children:(0,a.jsxs)(s.code,{className:"language-c",children:[(0,a.jsx)(s.span,{className:"token comment",children:"// clang/lib/CodeGen/CGExpr.cpp"}),"\n",(0,a.jsx)(s.span,{className:"token keyword",children:"const"})," SanitizerHandlerInfo SanitizerHandlers",(0,a.jsx)(s.span,{className:"token punctuation",children:"["}),(0,a.jsx)(s.span,{className:"token punctuation",children:"]"})," ",(0,a.jsx)(s.span,{className:"token operator",children:"="})," ",(0,a.jsx)(s.span,{className:"token punctuation",children:"{"}),"\n",(0,a.jsxs)(s.span,{className:"token macro property",children:[(0,a.jsx)(s.span,{className:"token directive-hash",children:"#"}),(0,a.jsx)(s.span,{className:"token directive keyword",children:"define"})," ",(0,a.jsx)(s.span,{className:"token macro-name function",children:"SANITIZER_CHECK"}),(0,a.jsxs)(s.span,{className:"token expression",children:[(0,a.jsx)(s.span,{className:"token punctuation",children:"("}),"Enum",(0,a.jsx)(s.span,{className:"token punctuation",children:","})," Name",(0,a.jsx)(s.span,{className:"token punctuation",children:","})," Version",(0,a.jsx)(s.span,{className:"token punctuation",children:")"})," ",(0,a.jsx)(s.span,{className:"token punctuation",children:"{"}),"#Name",(0,a.jsx)(s.span,{className:"token punctuation",children:","})," Version",(0,a.jsx)(s.span,{className:"token punctuation",children:"}"}),(0,a.jsx)(s.span,{className:"token punctuation",children:","})]})]}),"\n    LIST_SANITIZER_CHECKS\n",(0,a.jsxs)(s.span,{className:"token macro property",children:[(0,a.jsx)(s.span,{className:"token directive-hash",children:"#"}),(0,a.jsx)(s.span,{className:"token directive keyword",children:"undef"})," ",(0,a.jsx)(s.span,{className:"token expression",children:"SANITIZER_CHECK"})]}),"\n",(0,a.jsx)(s.span,{className:"token punctuation",children:"}"}),(0,a.jsx)(s.span,{className:"token punctuation",children:";"}),"\n\n"]})})})})]})]})}function t(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,a.jsx)(i,{...n,children:(0,a.jsx)(o,{...n})})}},6282:function(n,s,e){"use strict";function a(n){return n}e.d(s,{a:function(){return a}})}},function(n){n.O(0,[976,603,90,774,888,179],function(){return n(n.s=481)}),_N_E=n.O()}]);